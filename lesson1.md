# Lesson 1: tar 的 -C 参数要求目标目录必须已存在

## 🔴 错误 3：没有单元测试

Cursor 添加了 3 个测试：

1. **test_archive_new_and_extract_dir** - 测试路径解析
2. **test_scan_archives_finds_subfolder_archives** - 测试扫描子目录
3. **test_tar_extract_dir_created_before_extraction** - 测试 tar 目录创建

**教训：** 必须写测试来验证边界情况！

---

## 🔴 错误 4：盲目迭代，没有理解问题本质

### 我的错误行为

- v2.0.5 → v2.0.6 → v2.0.7 → v2.0.8
- 每次都在修症状，不是修根因
- 添加调试输出而不是理解路径逻辑

### 应该做的

1. 先画出数据流图：档案路径 → 父目录 → 解压目录
2. 理解 unrar/7zz 的工作目录概念
3. 写测试验证假设

---

## ✅ 学到的教训

1. **路径处理要清晰：** 始终使用绝对路径或 canonicalize()
2. **输出目录位置：** 在档案的父目录下创建 base_name 目录
3. **依赖工具的行为：** tar -C 需要目录存在，unrar 会自动创建
4. **测试驱动开发：** 先写测试，再修复代码
5. **举一反三：** 修复一个 archive type 时，要检查其他 type 是否有同样问题

---

## 💡 最痛的领悟

我花了 4 个版本迭代都没解决的问题，Cursor 一次就搞定了。

**关键原因：** 我没有理解**输出目录应该在档案的父目录下**这个基本概念！

---

**最后更新：** 2026-02-20
**版本：** v2.0.3 → v2.1.0 的修复历程
